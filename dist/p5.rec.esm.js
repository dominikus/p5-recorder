import{createFFmpeg as e}from"@ffmpeg/ffmpeg";var t,r,o=/frame=\s+(\d+)\s+fps/g,n=function(e){if(e&&e.message)for(var t;null!==(t=o.exec(e.message));){var n=+t[1]/r.totalFrames;!isNaN(n)&&r.onProgress&&r.onProgress(n)}},i=function(e,o){try{return console.log("transcoding"),r=o,console.log("loading ffmpeg"),Promise.resolve(t.load()).then(function(){return console.log("start transcoding"),Promise.resolve(t.write("input.webm",e)).then(function(){return Promise.resolve(t.run("-r "+r.framerate+" -i input.webm -s "+r.width+"x"+r.height+" -crf "+r.crf+" -preset "+r.preset+" -tune animation -pix_fmt yuv420p output.mp4")).then(function(){var e=t.read("output.mp4");return Promise.resolve(t.remove("input.webm")).then(function(){return Promise.resolve(t.remove("output.mp4")).then(function(){r.onFinish(e)})})})})})}catch(e){return Promise.reject(e)}},s=["ultrafast","superfast","veryfast","faster","fast","medium","slow","slower","veryslow"];!function(){var r=!1,o={},a=!1,l=[];p5.prototype.startRecording=function(u){var c=this;if(void 0===u&&(u={}),this.noLoop(),!a){!function(r){void 0===r&&(r=!1);var o={log:!1,logger:n};o.corePath=r?"/node_modules/@ffmpeg/core/ffmpeg-core.js":"https://unpkg.com/@ffmpeg/core@v0.7.1/ffmpeg-core.js",t=e(o)}(u.standalone);var f=this._draw;this._draw=function(){try{f();var e=function(){if(r)c.canvas?c.canvas.toBlob(function(e){try{return l.push(e),c._requestAnimId=window.requestAnimationFrame(c._draw),Promise.resolve()}catch(e){return Promise.reject(e)}}):c._requestAnimId=window.requestAnimationFrame(c._draw);else{var e=function(){if(l.length>0)return o.totalFrames=l.length,console.log("got "+o.totalFrames+" frames"),Promise.resolve(new Blob(l).arrayBuffer()).then(function(e){var t=new Uint8Array(e);return l=[],Promise.resolve(i(t,o)).then(function(){c._requestAnimId=window.requestAnimationFrame(c._draw)})});c._requestAnimId=window.requestAnimationFrame(c._draw)}();if(e&&e.then)return e.then(function(){})}}();return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},this._draw(),a=!0}r=!0;var m=u.preset,d=u.crf,p=u.onProgress,h=u.onFinish;m&&s.includes(m)||(m="slow"),(void 0===d||isNaN(d)||d<0||d>51)&&(d=18),p||(p=function(e){return console.log(e)}),h||(h=function(e){!function(e,t){var r=document.createElement("div");r.style.width="100%",r.style.height="100%",r.style.position="fixed",r.style.display="flex",r.style.top="0px",r.style.left="0px",r.style.backgroundColor="rgba(0,0,0,0.8)";var o=document.createElement("button");o.innerHTML="&times;",o.style.color="white",o.style.backgroundColor="black",o.style.border="3px solid white",o.style.borderRadius="100%",o.style.fontSize="16px",o.style.fontWeight="bold",o.style.padding="2px 6px 1px 6px",o.style.position="fixed",o.style.top="10px",o.style.right="10px",o.onclick=function(){r.remove()},r.appendChild(o);var n=document.createElement("video");n.width=t.width,n.height=t.height,n.style.display="block",n.style.margin="auto",n.loop=!0,n.controls=!0;var i=URL.createObjectURL(new Blob([e.buffer],{type:"video/mp4"}));n.src=i,r.appendChild(n),document.querySelector("body").appendChild(r)}(e,o)}),o={width:this.width,height:this.height,pixelDensity:this._pixelDensity,framerate:this._targetFrameRate,crf:d,preset:m,onProgress:p,onFinish:h},console.log(o)},p5.prototype.stopRecording=function(){r=!1}}();
//# sourceMappingURL=p5.rec.esm.js.map
