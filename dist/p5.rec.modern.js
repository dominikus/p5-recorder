import{createFFmpeg as e}from"@ffmpeg/ffmpeg";let t,o;const s=/frame=\s+(\d+)\s+fps/g,i=e=>{if(e&&e.message){let t;for(;null!==(t=s.exec(e.message));){const e=+t[1]/o.totalFrames;!isNaN(e)&&o.onProgress&&o.onProgress(e)}}},n=async(e,s)=>{console.log("transcoding"),o=s,console.log("loading ffmpeg"),await t.load(),console.log("start transcoding"),await t.write("input.webm",e);const i=`-r ${o.framerate} -i input.webm -s ${o.width}x${o.height} -crf ${o.crf} -preset ${o.preset} -tune animation -pix_fmt yuv420p output.mp4`;await t.run(i);const n=t.read("output.mp4");await t.remove("input.webm"),await t.remove("output.mp4"),o.onFinish(n)},r=["ultrafast","superfast","veryfast","faster","fast","medium","slow","slower","veryslow"];!function(){let o=!1,s={},a=!1,l=[];p5.prototype.startRecording=function(p={}){if(this.noLoop(),!a){((o=!1)=>{let s={log:!1,logger:i};s.corePath=o?"/node_modules/@ffmpeg/core/ffmpeg-core.js":"https://unpkg.com/@ffmpeg/core@v0.7.1/ffmpeg-core.js",t=e(s)})(p.standalone);const r=this._draw;this._draw=async()=>{if(r(),o)this.canvas?this.canvas.toBlob(async e=>{l.push(e),this._requestAnimId=window.requestAnimationFrame(this._draw)}):this._requestAnimId=window.requestAnimationFrame(this._draw);else if(l.length>0){s.totalFrames=l.length,console.log(`got ${s.totalFrames} frames`);const e=new Uint8Array(await new Blob(l).arrayBuffer());l=[],await n(e,s),this._requestAnimId=window.requestAnimationFrame(this._draw)}else this._requestAnimId=window.requestAnimationFrame(this._draw)},this._draw(),a=!0}o=!0;let{preset:d,crf:c,onProgress:m,onFinish:h}=p;d&&r.includes(d)||(d="slow"),(void 0===c||isNaN(c)||c<0||c>51)&&(c=18),m||(m=e=>console.log(e)),h||(h=e=>{!function(e,t){const o=document.createElement("div");o.style.width="100%",o.style.height="100%",o.style.position="fixed",o.style.display="flex",o.style.top="0px",o.style.left="0px",o.style.backgroundColor="rgba(0,0,0,0.8)";const s=document.createElement("button");s.innerHTML="&times;",s.style.color="white",s.style.backgroundColor="black",s.style.border="3px solid white",s.style.borderRadius="100%",s.style.fontSize="16px",s.style.fontWeight="bold",s.style.padding="2px 6px 1px 6px",s.style.position="fixed",s.style.top="10px",s.style.right="10px",s.onclick=()=>{o.remove()},o.appendChild(s);const i=document.createElement("video");i.width=t.width,i.height=t.height,i.style.display="block",i.style.margin="auto",i.loop=!0,i.controls=!0;var n=URL.createObjectURL(new Blob([e.buffer],{type:"video/mp4"}));i.src=n,o.appendChild(i),document.querySelector("body").appendChild(o)}(e,s)}),s={width:this.width,height:this.height,pixelDensity:this._pixelDensity,framerate:this._targetFrameRate,crf:c,preset:d,onProgress:m,onFinish:h},console.log(s)},p5.prototype.stopRecording=function(){o=!1}}();
//# sourceMappingURL=p5.rec.modern.js.map
